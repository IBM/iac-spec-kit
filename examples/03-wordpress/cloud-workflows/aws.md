# AWS Workflow for WordPress Deployment

This guide shows the commands and prompts to deploy WordPress infrastructure on AWS using IaC Spec Kit.

> **Note**: The specific files, directory names, and some outputs are generated by the AI and will vary depending on your AI tool (Bob, Claude, Copilot, Gemini, etc.) and the LLM model being used. The workflow structure and file types remain consistent.

## Prerequisites

- AWS account with IAM permissions
- IaC Spec Kit installed (`iac-specify check`)
- Terraform installed
- AI coding assistant running in your project directory

## Commands

### Step 1: Establish Project Principles

Principles define your project's governance rules and guide all subsequent development decisions.

```
/iac.principles I'm building small production infrastructure on AWS. Start simple, keep costs down, use Terraform.
```

**What this does**: The AI will interview you briefly (if needed) to understand your environment, then generate governance rules covering:
- Cloud Architecture Principles (security defaults, observability, resource identification)
- IaC Code Principles (prefer well-maintained modules, testing requirements, security practices)
- Implementation Approaches (progressive complexity: start simple, add features as needed)
- Governance rules (how principles are enforced and amended)

**Generates**: `.specify/memory/principles.md`

**principles.md** contains versioned governance rules including architecture principles (like security defaults, resource tagging), code principles (like prefer curated modules, testing requirements), implementation approaches (like progressive complexity), and amendment procedures. Specific principles and their wording vary by AI tool and LLM model.

---

### Step 2: Describe What You Want

Create a technology-agnostic specification describing WHAT infrastructure you need and WHY, without specifying HOW to build it.

```
/iac.specify I need to deploy WordPress for my small business website. Should handle a few thousand visitors per day, needs to be secure with automated backups. Budget is around $500/month. Use the official WordPress Docker image.
```

**What this does**: The AI analyzes your description, makes informed assumptions based on industry standards, and creates a detailed infrastructure specification. If anything is critically ambiguous, it will ask up to 3 clarifying questions.

**Generates**:
- `spec.md` in a feature directory (directory name is AI-generated based on your description)
- `checklists/requirements.md` for quality validation

**spec.md** contains a cloud-agnostic specification with sections like executive summary, problem statement, infrastructure requirements, SLOs, cost constraints, success criteria, and assumptions. For example, functional requirements might include:
- Compute resources for containerized applications
- Managed relational database with automated backups
- Object storage for media files
- Load balancer for traffic distribution
- Isolated network with public/private separation

Uses generic terms rather than cloud-specific services (e.g., "managed database" not "RDS"). Specific sections and detail vary by AI tool and LLM model.

---

### Step 3: Clarify Requirements (Optional)

Run structured clarification to resolve any ambiguities before planning. This reduces rework later.

```
/iac.clarify
```

**What this does**: The AI scans your spec for underspecified areas and asks targeted questions (max 5 per session) about scope, security, cost, or technical details. Questions are presented with multiple-choice options and the AI recommends answers based on your context.

**Updates**: `spec.md` with your answers integrated into the appropriate sections

**Example questions you might see**:
- "What's your expected traffic pattern?" → Options: <1K visitors/day, 1K-10K, >10K
- "Do you need multi-zone high availability?" → Options: Single zone (lower cost), Multi-zone (higher reliability)
- "What's your backup retention requirement?" → Options: 7 days, 30 days, 90 days

You can skip this step if you're confident the spec captures everything, or you can run it later if you discover ambiguities.

---

### Step 4: Create Implementation Plan

Now you specify your cloud provider and architectural preferences. The AI will research best practices and design the AWS-specific architecture.

**You can provide varying levels of detail.** The framework already knows from your principles and spec that you want AWS, cost-effective setup, containerized WordPress, etc. Only add details if you have specific requirements not already captured.

**Option A - Minimal** (let the framework decide everything):
```
/iac.plan
```
The AI chooses appropriate AWS services based on your spec and principles.

**Option B - Basic guidance** (add region or simple preference):
```
/iac.plan Use us-east-1 region
```
Specifies deployment region, AI decides services.

**Option C - Some direction** (add architectural preferences):
```
/iac.plan Deploy in us-east-1. Prefer managed services to minimize operations.
```
Adds preference for managed vs self-managed options.

**Option D - More specific** (specify key services):
```
/iac.plan Deploy in us-east-1. Use ECS Fargate for containers, RDS MySQL for database, S3 for media storage.
```
Directs specific AWS service choices.

**Option E - Very detailed** (full architectural specification):
```
/iac.plan Deploy in us-east-1. Use ECS Fargate for WordPress containers with Application Load Balancer. RDS MySQL in private subnet with automated backups. S3 bucket for media files. VPC with public/private subnets across 2 availability zones. Use terraform-aws-modules where available.
```
Provides complete architecture direction.

**What this does**: The AI researches AWS best practices, well-architected framework pillars (Security, Reliability, Performance Efficiency, Cost Optimization, Operational Excellence), and terraform-aws-modules. It then designs the complete infrastructure architecture, checks it against your principles, and generates multiple planning documents.

**Generates**:
- `plan.md` - Main architecture plan
- `research.md` - Technology decisions and justifications
- `architecture.md` - Detailed component specifications
- `modules.md` - Terraform module specifications (if using modules)
- `quickstart.md` - Deployment procedures
- Updates agent-specific context files

**plan.md** contains the main architecture plan including technical context (AWS, Terraform, state backend), principles validation, and infrastructure architecture. For example:
- Compute: ECS Fargate with auto-scaling
- Storage: RDS MySQL with multi-AZ and S3 for media
- Networking: VPC with public/private subnets across availability zones

Specific services and implementation details vary by AI tool and LLM model.

**research.md** contains technology decisions and justifications. May include:
- Cloud provider rationale
- Well-Architected Framework mappings (e.g., Security → private subnets, Cost Optimization → right-sized instances)
- Curated modules identified (terraform-aws-modules for VPC/ECS/RDS)
- Best practices and patterns

Content and depth vary by AI tool and LLM model.

**architecture.md** contains detailed component specifications, resource dependencies, configuration parameters, and possibly network topology diagrams. Level of detail varies by AI tool and LLM model.

**modules.md** (if generated) contains module specifications with input/output variables and dependencies. Whether this file is created and its content vary by AI tool and LLM model.

**quickstart.md** contains deployment procedures including prerequisites, initialization steps, and deployment commands. Specific steps and detail level vary by AI tool and LLM model.

---

### Step 5: Generate Task Breakdown

Break down the architecture plan into ordered, actionable tasks organized by infrastructure tiers.

```
/iac.tasks
```

**What this does**: The AI analyzes all planning documents and creates a phased task list that respects infrastructure dependencies (e.g., network must exist before compute). Tasks are organized by tier (Foundation → Network → Compute/Data → Application) with clear execution order and parallelization opportunities.

**Generates**: `tasks.md`

**tasks.md** contains an ordered task breakdown organized by tiers (Setup, Foundation, Network, Compute/Data, Application, Validation). Each task has checkbox format with ID, parallel marker [P], and file path. Example tasks:
- Create VPC and subnets in iac/vpc.tf
- Configure ECS cluster in iac/ecs.tf
- Set up RDS database in iac/rds.tf

Specific tasks and organization vary by AI tool and LLM model.

**Example tasks**:
```
Phase 1: Setup
- [ ] T001 Create iac/ directory structure per plan.md
- [ ] T002 Create .gitignore with Terraform patterns

Phase 2: Foundation
- [ ] T003 [P] Configure Terraform backend (S3 + DynamoDB) in iac/backend.tf
- [ ] T004 [P] Configure AWS provider in iac/provider.tf
- [ ] T005 [P] Define variables in iac/variables.tf
- [ ] T006 Validation: terraform init && terraform validate

Phase 3: Network Tier
- [ ] T007 Create VPC and subnets in iac/vpc.tf using terraform-aws-modules/vpc
- [ ] T008 [P] Create security groups in iac/security-groups.tf
- [ ] T009 Create NAT gateways and routing in iac/networking.tf
- [ ] T010 Validation: terraform validate

Phase 4: Compute & Data Tier
- [ ] T011 Create ECS cluster in iac/ecs.tf using terraform-aws-modules/ecs
- [ ] T012 [P] Create RDS MySQL database in iac/rds.tf
- [ ] T013 [P] Create S3 buckets in iac/s3.tf
- [ ] T014 Create ALB in iac/alb.tf (depends on VPC)
- [ ] T015 Create ECS task definition in iac/ecs-tasks.tf (depends on RDS, S3, ALB)
```

---

### Step 6: Implement Infrastructure Code

Execute all tasks to generate the Terraform configuration files.

```
/iac.implement
```

**What this does**: The AI reads `tasks.md` and executes each task in order, respecting dependencies and parallelization markers. It generates Terraform .tf files following AWS and Terraform best practices, runs formatting and validation, and marks completed tasks as [X] in tasks.md.

**Important**: This command generates infrastructure code only - it does NOT deploy to AWS (no `terraform apply`). Deployment is a manual step you control.

**Generates**: Terraform configuration files (`.tf` files). Example files might include:
- backend.tf (S3 state storage)
- provider.tf (AWS provider config)
- vpc.tf (VPC and subnets)
- ecs.tf (container cluster), rds.tf (database), s3.tf (object storage)
- alb.tf (load balancer), security-groups.tf, iam.tf, outputs.tf

The AI also runs `terraform fmt` and `terraform validate`. Specific files and organization vary by AI tool and LLM model.

**Updates**: `tasks.md` with completed tasks marked as `- [X]`

---

## What Happens Next

After `/iac.implement` completes, you have production-ready Terraform code. The next steps are **manual** and outside the scope of IaC Spec Kit:

1. **Review the generated code**
   ```bash
   cd iac/
   ls -la
   cat vpc.tf  # Review VPC configuration
   cat ecs.tf  # Review ECS setup
   ```

2. **Initialize Terraform** (downloads AWS provider and modules)
   ```bash
   terraform init
   ```

3. **Review the execution plan** (see what will be created)
   ```bash
   terraform plan
   ```
   This shows all AWS resources that will be created, modified, or destroyed.

4. **Deploy to AWS** (YOUR responsibility - creates real resources and incurs costs)
   ```bash
   terraform apply
   ```
   Review the plan carefully before typing "yes". This creates actual AWS resources.

5. **Access your WordPress site**
   After apply completes, get the ALB DNS name:
   ```bash
   terraform output alb_dns_name
   ```
   Visit that URL to complete WordPress installation.

---

## Key Points to Remember

- **Directory names are AI-generated**: Don't expect specific names like "001-wordpress". The AI decides based on your description.
- **Results vary by AI tool**: Claude, Copilot, Gemini may generate slightly different file organizations or module choices.
- **Principles are project-wide**: They apply to ALL features you build, not just WordPress. That's why the prompt doesn't mention WordPress.
- **Specs are technology-agnostic**: No AWS-specific terms in spec.md - only generic infrastructure concepts like "managed database" and "object storage".
- **Plans are AWS-specific**: plan.md and architecture.md contain AWS service names (ECS, RDS, S3) and terraform-aws-modules.
- **Deployment is manual**: IaC Spec Kit generates code, YOU run `terraform apply` to actually create AWS resources.
- **Cost awareness**: Running `terraform apply` creates real AWS resources that cost money. Review pricing first.

---

## Files Generated Summary

| Command | Files Created | Purpose |
|---------|---------------|---------|
| `/iac.principles` | `principles.md` | Project governance rules and decision-making framework |
| `/iac.specify` | `spec.md`, `checklists/requirements.md` | Cloud-agnostic infrastructure requirements and validation checklist |
| `/iac.clarify` | Updates `spec.md` | Resolves ambiguities through structured questions |
| `/iac.plan` | `plan.md`, `research.md`, `architecture.md`, `modules.md`, `quickstart.md` | AWS-specific architecture and implementation strategy |
| `/iac.tasks` | `tasks.md` | Ordered task breakdown by infrastructure tier with dependencies |
| `/iac.implement` | `*.tf` files in `iac/` directory | Terraform code ready for review and deployment |
