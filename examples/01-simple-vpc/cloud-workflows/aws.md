# AWS Workflow for Simple VPC

This guide shows the commands and prompts to deploy a simple VPC on AWS using IaC Spec Kit.

> **Note**: The specific files, directory names, and some outputs are generated by the AI and will vary depending on your AI tool (Bob, Claude, Copilot, Gemini, etc.) and the LLM model being used. The workflow structure and file types remain consistent.

## Prerequisites

- AWS account with IAM permissions
- AWS CLI installed and configured (`aws configure`)
- IaC Spec Kit installed (`iac-specify check`)
- Terraform installed
- AI coding assistant running in your project directory

## Commands

### Step 1: Establish Project Principles

```
/iac.principles I'm building basic networking infrastructure on AWS. Start simple, keep costs down, use Terraform.
```

**What this does**: The AI will interview you briefly (if needed) to understand your environment, then generate governance rules covering architecture principles, code principles, implementation approaches, and governance rules.

**Generates**: `.specify/memory/principles.md`

**principles.md** contains versioned governance rules including architecture principles (like security defaults, resource tagging), code principles (like prefer curated modules, testing requirements), implementation approaches (like progressive complexity), and amendment procedures. Specific principles and their wording vary by AI tool and LLM model.

---

### Step 2: Describe What You Want

```
/iac.specify I need a basic virtual private network with public and private subnets. Should include a bastion host for secure access to private resources. This is for a development environment, so keep it simple and cost-effective.
```

**What this does**: The AI analyzes your description, makes informed assumptions based on industry standards, and creates a detailed infrastructure specification. If anything is critically ambiguous, it will ask up to 3 clarifying questions.

**Generates**:
- `spec.md` in a feature directory (directory name is AI-generated based on your description)
- `checklists/requirements.md` for quality validation

**spec.md** contains a cloud-agnostic specification with sections like executive summary, problem statement, infrastructure requirements, SLOs, cost constraints, success criteria, and assumptions. For example, functional requirements might include:
- Isolated virtual network with defined address space
- Public subnet for internet-facing resources
- Private subnet for internal resources
- Internet gateway for public subnet connectivity
- NAT gateway for private subnet outbound access
- Bastion host in public subnet for secure administrative access
- Network security controls with least-privilege access

Uses generic terms rather than cloud-specific services (e.g., "NAT gateway" not "AWS NAT Gateway"). Specific sections and detail vary by AI tool and LLM model.

---

### Step 3: Clarify Requirements (Optional)

Run structured clarification to resolve any ambiguities before planning.

```
/iac.clarify
```

**What this does**: The AI scans your spec for underspecified areas and asks targeted questions (max 5 per session) about scope, security, cost, or technical details. Questions are presented with multiple-choice options and the AI recommends answers based on your context.

**Updates**: `spec.md` with your answers integrated into the appropriate sections

**Example questions you might see**:
- "How many availability zones?" → Options: Single zone (lower cost), Multiple zones (higher availability)
- "NAT gateway configuration?" → Options: One per AZ (HA), Shared across AZs (cost-effective)
- "Bastion host type?" → Options: Always-on instance, On-demand instance, Session Manager only

You can skip this step if you're confident the spec captures everything.

---

### Step 4: Create Implementation Plan

Now you specify your cloud provider and architectural preferences. The AI will research best practices and design the AWS-specific architecture.

**Option A - Minimal**:
```
/iac.plan
```

**Option B - Basic guidance**:
```
/iac.plan Use us-east-1 region
```

**Option C - Some direction**:
```
/iac.plan Deploy in us-east-1. Use a single NAT Gateway to keep costs down.
```

**What this does**: The AI researches AWS best practices, well-architected framework pillars, and terraform-aws-modules. It then designs the complete network architecture, checks it against your principles, and generates multiple planning documents.

**Generates**:
- `plan.md` - Main architecture plan
- `research.md` - Technology decisions and justifications
- `architecture.md` - Detailed component specifications
- `modules.md` - Terraform module specifications (if using modules)
- `quickstart.md` - Deployment procedures
- Updates agent-specific context files

**plan.md** contains the main architecture plan including technical context (AWS, Terraform, state backend), principles validation, and infrastructure architecture. For example:
- Networking: VPC with CIDR block, public/private subnets across availability zones
- Connectivity: Internet Gateway for public subnets, NAT Gateway for private subnet outbound
- Security: Security groups with least-privilege rules, Network ACLs
- Access: EC2 bastion host or Systems Manager Session Manager

Specific services and implementation details vary by AI tool and LLM model.

**research.md** contains technology decisions and justifications. May include:
- Cloud provider rationale
- Well-Architected Framework mappings (e.g., Security → network isolation, Cost Optimization → single NAT Gateway)
- Curated modules identified (terraform-aws-modules/vpc)
- Best practices and patterns

Content and depth vary by AI tool and LLM model.

**architecture.md** contains detailed component specifications, resource dependencies, configuration parameters, and possibly network topology diagrams. Level of detail varies by AI tool and LLM model.

**modules.md** (if generated) contains module specifications with input/output variables and dependencies. Whether this file is created and its content vary by AI tool and LLM model.

**quickstart.md** contains deployment procedures including prerequisites, initialization steps, and deployment commands. Specific steps and detail level vary by AI tool and LLM model.

---

### Step 5: Generate Task Breakdown

Break down the architecture plan into ordered, actionable tasks.

```
/iac.tasks
```

**What this does**: The AI analyzes all planning documents and creates a phased task list that respects infrastructure dependencies. Tasks are organized by tier with clear execution order and parallelization opportunities.

**Generates**: `tasks.md`

**tasks.md** contains an ordered task breakdown organized by tiers (Setup, Foundation, Network, Validation). Each task has checkbox format with ID, parallel marker [P], and file path. Example tasks:
- Create VPC with CIDR block in iac/vpc.tf
- Configure public and private subnets in iac/subnets.tf
- Set up Internet Gateway and NAT Gateway in iac/gateways.tf
- Configure route tables in iac/routes.tf
- Create security groups in iac/security-groups.tf
- Deploy bastion host in iac/bastion.tf

Specific tasks and organization vary by AI tool and LLM model.

---

### Step 6: Implement Infrastructure Code

Execute all tasks to generate the Terraform configuration files.

```
/iac.implement
```

**What this does**: The AI reads `tasks.md` and executes each task in order, respecting dependencies and parallelization markers. It generates Terraform .tf files following AWS and Terraform best practices, runs formatting and validation, and marks completed tasks as [X] in tasks.md.

**Important**: This command generates infrastructure code only - it does NOT deploy to AWS (no `terraform apply`). Deployment is a manual step you control.

**Generates**: Terraform configuration files (`.tf` files). Example files might include:
- backend.tf (S3 state storage)
- provider.tf (AWS provider config)
- vpc.tf (VPC configuration)
- subnets.tf (public and private subnets), gateways.tf (IGW and NAT Gateway)
- routes.tf (route tables), security-groups.tf, bastion.tf (if using EC2 bastion)
- outputs.tf

The AI also runs `terraform fmt` and `terraform validate`. Specific files and organization vary by AI tool and LLM model.

**Updates**: `tasks.md` with completed tasks marked as `- [X]`

---

## What Happens Next

After `/iac.implement` completes, you have production-ready Terraform code. The next steps are **manual** and outside the scope of IaC Spec Kit:

1. **Review the generated code**
   ```bash
   cd iac/
   ls -la
   cat vpc.tf
   cat subnets.tf
   ```

2. **Initialize Terraform**
   ```bash
   terraform init
   ```

3. **Review the execution plan**
   ```bash
   terraform plan
   ```

4. **Deploy to AWS** (creates real resources and incurs costs)
   ```bash
   terraform apply
   ```

5. **Access your VPC**
   ```bash
   terraform output vpc_id
   terraform output bastion_public_ip
   ```

---

## Key Points to Remember

- **Directory names are AI-generated**: Don't expect specific names. The AI decides based on your description.
- **Results vary by AI tool**: Claude, Copilot, Gemini may generate slightly different file organizations.
- **Principles are project-wide**: They apply to ALL features you build, not just this VPC.
- **Specs are technology-agnostic**: No AWS-specific terms in spec.md.
- **Plans are AWS-specific**: plan.md contains AWS service names (VPC, IGW, NAT Gateway, EC2).
- **Deployment is manual**: IaC Spec Kit generates code, YOU run `terraform apply`.
- **Cost awareness**: Running `terraform apply` creates real AWS resources that cost money.

---

## Files Generated Summary

| Command | Files Created | Purpose |
|---------|---------------|---------|
| `/iac.principles` | `principles.md` | Project governance rules and decision-making framework |
| `/iac.specify` | `spec.md`, `checklists/requirements.md` | Cloud-agnostic infrastructure requirements and validation checklist |
| `/iac.clarify` | Updates `spec.md` | Resolves ambiguities through structured questions |
| `/iac.plan` | `plan.md`, `research.md`, `architecture.md`, `modules.md`, `quickstart.md` | AWS-specific architecture and implementation strategy |
| `/iac.tasks` | `tasks.md` | Ordered task breakdown by infrastructure tier with dependencies |
| `/iac.implement` | `*.tf` files in `iac/` directory | Terraform code ready for review and deployment |
