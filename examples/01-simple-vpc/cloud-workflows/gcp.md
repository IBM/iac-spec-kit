# GCP Workflow for Simple VPC

This guide shows the commands and prompts to deploy a simple VPC Network on Google Cloud Platform using IaC Spec Kit.

> **Note**: The specific files, directory names, and some outputs are generated by the AI and will vary depending on your AI tool (Bob, Claude, Copilot, Gemini, etc.) and the LLM model being used. The workflow structure and file types remain consistent.

## Prerequisites

- GCP project with billing enabled
- IaC Spec Kit installed (`iac-specify check`)
- Terraform installed
- AI coding assistant running in your project directory

## Commands

### Step 1: Establish Project Principles

```
/iac.principles I'm building basic networking infrastructure on GCP. Start simple, keep costs down, use Terraform.
```

**What this does**: The AI generates governance rules for your project covering architecture principles, code principles, and implementation approaches.

**Generates**: `.specify/memory/principles.md`

**principles.md** contains versioned governance rules including architecture principles (like security defaults, resource tagging), code principles (like prefer curated modules, testing requirements), implementation approaches (like progressive complexity), and amendment procedures. Specific principles and their wording vary by AI tool and LLM model.

---

### Step 2: Describe What You Want

```
/iac.specify I need a basic virtual private network with public and private subnets. Should include a bastion host for secure access to private resources. This is for a development environment, so keep it simple and cost-effective.
```

**What this does**: The AI creates a cloud-agnostic infrastructure specification. If anything is critically ambiguous, it will ask up to 3 clarifying questions.

**Generates**:
- `spec.md` in a feature directory (directory name is AI-generated based on your description)
- `checklists/requirements.md` for quality validation

**spec.md** contains a cloud-agnostic specification with sections like executive summary, problem statement, infrastructure requirements, SLOs, cost constraints, success criteria, and assumptions. For example, functional requirements might include:
- Isolated virtual network with defined address space
- Public subnet for internet-facing resources
- Private subnet for internal resources
- Internet gateway for public subnet connectivity
- NAT gateway for private subnet outbound access
- Bastion host in public subnet for secure administrative access
- Network security controls with least-privilege access

Uses generic terms rather than cloud-specific services (e.g., "NAT gateway" not "Cloud NAT"). Specific sections and detail vary by AI tool and LLM model.

---

### Step 3: Clarify Requirements (Optional)

```
/iac.clarify
```

**What this does**: The AI scans your spec for underspecified areas and asks targeted questions (max 5 per session). Questions are presented with multiple-choice options and the AI recommends answers.

**Updates**: `spec.md` with your answers integrated

---

### Step 4: Create Implementation Plan

**Option A - Minimal**:
```
/iac.plan
```

**Option B - Basic guidance**:
```
/iac.plan Use us-central1 region
```

**Option C - Some direction**:
```
/iac.plan Deploy in us-central1. Use Cloud NAT for private subnet outbound connectivity.
```

**What this does**: The AI researches GCP best practices, architecture framework principles, and terraform-google-modules. It then designs the complete network architecture and generates planning documents.

**Generates**:
- `plan.md` - Main architecture plan
- `research.md` - Technology decisions and justifications
- `architecture.md` - Detailed component specifications
- `modules.md` - Terraform module specifications (if using modules)
- `quickstart.md` - Deployment procedures
- Updates agent-specific context files

**plan.md** contains the main architecture plan including technical context (GCP, Terraform, state backend), principles validation, and infrastructure architecture. For example:
- Networking: VPC Network with custom mode, public/private subnets
- Connectivity: Cloud NAT for private subnet outbound access
- Security: Firewall rules with least-privilege access
- Access: Bastion host or Identity-Aware Proxy

Specific services and implementation details vary by AI tool and LLM model.

**research.md** contains technology decisions and justifications. May include:
- Cloud provider rationale
- Architecture Framework mappings (e.g., Security → firewall rules, Cost Optimization → right-sized instances)
- Curated modules identified (terraform-google-modules)
- Best practices and patterns

Content and depth vary by AI tool and LLM model.

**architecture.md** contains detailed component specifications, resource dependencies, configuration parameters, and possibly network topology diagrams. Level of detail varies by AI tool and LLM model.

**modules.md** (if generated) contains module specifications with input/output variables and dependencies. Whether this file is created and its content vary by AI tool and LLM model.

**quickstart.md** contains deployment procedures including prerequisites, initialization steps, and deployment commands. Specific steps and detail level vary by AI tool and LLM model.

---

### Step 5: Generate Task Breakdown

```
/iac.tasks
```

**What this does**: The AI creates a phased task list organized by infrastructure tiers with clear execution order and parallelization opportunities.

**Generates**: `tasks.md`

**tasks.md** contains an ordered task breakdown organized by tiers (Setup, Foundation, Network, Validation). Each task has checkbox format with ID, parallel marker [P], and file path. Example tasks:
- Create VPC Network in custom mode in iac/vpc.tf
- Configure public and private subnets in iac/subnets.tf
- Set up Cloud NAT and Cloud Router in iac/nat.tf
- Configure firewall rules in iac/firewall.tf
- Deploy bastion host in iac/bastion.tf

Specific tasks and organization vary by AI tool and LLM model.

---

### Step 6: Implement Infrastructure Code

```
/iac.implement
```

**What this does**: The AI executes tasks to generate Terraform .tf files, runs formatting and validation, and marks completed tasks.

**Important**: This generates infrastructure code only - it does NOT deploy to GCP (no `terraform apply`).

**Generates**: Terraform configuration files (`.tf` files). Example files might include:
- backend.tf (Cloud Storage state)
- provider.tf (GCP provider config)
- vpc.tf (VPC Network)
- subnets.tf (subnets), nat.tf (Cloud NAT and Cloud Router)
- firewall.tf (firewall rules), bastion.tf
- outputs.tf

The AI also runs `terraform fmt` and `terraform validate`. Specific files and organization vary by AI tool and LLM model.

**Updates**: `tasks.md` with completed tasks marked as `- [X]`

---

## What Happens Next

After `/iac.implement` completes, you have production-ready Terraform code. The next steps are **manual**:

1. Review the generated code
2. Initialize Terraform: `terraform init`
3. Review execution plan: `terraform plan`
4. Deploy to GCP: `terraform apply` (creates real resources and incurs costs)
5. Access your VPC Network using the output values

---

## Key Points to Remember

- **Directory names are AI-generated**: The AI decides based on your description.
- **Results vary by AI tool**: Different tools may generate slightly different organizations.
- **Principles are project-wide**: They apply to ALL features, not just this VPC.
- **Specs are technology-agnostic**: Uses generic terms, not GCP-specific services.
- **Plans are GCP-specific**: Contains GCP service names and terraform-google-modules.
- **Deployment is manual**: You run `terraform apply` to create actual GCP resources.
- **Cost awareness**: `terraform apply` creates real resources that cost money.

---

## Files Generated Summary

| Command | Files Created | Purpose |
|---------|---------------|---------|
| `/iac.principles` | `principles.md` | Project governance rules |
| `/iac.specify` | `spec.md`, `checklists/requirements.md` | Cloud-agnostic requirements |
| `/iac.clarify` | Updates `spec.md` | Resolves ambiguities |
| `/iac.plan` | `plan.md`, `research.md`, `architecture.md`, `modules.md`, `quickstart.md` | GCP-specific architecture |
| `/iac.tasks` | `tasks.md` | Ordered task breakdown |
| `/iac.implement` | `*.tf` files | Terraform code ready for deployment |
